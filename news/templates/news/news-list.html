{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load custom_filters %}

{% block breadcrumb %}
    <li class="breadcrumb-item active">{{ page_title }}</li>
{% endblock breadcrumb %}

{% block content %}
    <br>
    <div class="mb-4">
        <a href="{% url 'news-create' %}" class="btn btn-outline-dark">Nowe ogłoszenie</a>
    </div>
    <br>

    {% for news in queryset %}
        {% if request.user.profile in news.allowed_profiles.all or request.user.profile.character_status == 'gm' %}
            <table>
                <tbody>
                    <tr class="posts-and-news">
                        <td>
                            <img class="rounded-circle article-img" src="{{ news.author.profile.image.url }}">
                            <small>{{ news.date_posted|date:'d-M-Y' }}</small>
                        </td>
                        <td>
                            <small>Ostatnia aktywność:
                                {% if news_with_last_activity_dict|dict_lookup:news %}
                                    {{ news_with_last_activity_dict|dict_lookup:news|date:'d-M-Y, H:i' }}
                                {% else %}
                                    {{ news.date_updated|date:'d-M-Y, H:i' }}
                                {% endif %}
                            </small>
                            <h3 class="unblue"><a href="{{ news.get_absolute_url }}">{{ news.title }}</a></h3>
                        </td>
                    </tr>
                </tbody>
            </table><br>
        {% endif %}
    {% endfor %}

{% endblock content %}