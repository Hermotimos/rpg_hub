

<div class="container my-1 border rounded
    {% if thread in unseen %}
        border-dark
        {% if thread_kind == 'Announcement' %}
            bg-bluish
        {% elif thread_kind == 'Debate' %}
            bg-greengrayish
        {% endif %}
    {% else %}
        bg-inner
    {% endif %}">
    <span class="pt-5" id="thread_{{ thread.id }}"></span>
    <div class="row p-1">
        <div class="col-auto px-0 mr-n3">
            <img class="portait img-md rounded
                {% if thread_kind == 'Announcement' %}
                     rounded
                {% elif thread_kind == 'Debate' %}
                     rounded-circle
                {% endif %}"
                 src="{{ thread.statements.first.author.image.url }}">
        </div>
        <div class="col pr-0 ml-n1">
            <div class="container h-100">
                <div class="row h-100">
                    <div class="col pr-0">
                        <div class="font-11 font-italic text-muted align-top">
                            {{ thread.created_at|date:'d-M-Y | H:i' }}
                            {% if current_profile in thread.followers.all %}
                                <a class="icon-unfollow ml-1" href="{% url 'communications:unfollow' thread.id %}"
                                   data-toggle="tooltip" data-placement="bottom" title="Nie obserwuj">
                                </a>
                            {% else %}
                                <a class="icon-follow ml-1" href="{% url 'communications:follow' thread.id %}"
                                    data-toggle="tooltip" data-placement="bottom" title="Obserwuj">
                                </a>
                            {% endif %}
                        </div>
                        <div class="font-16 ">
                            <a class="border-bottom align-top" href="{% url 'communications:thread' thread.id tag_title %}#page-bottom">
                                {{ thread.title|capfirst }}
                            </a>
                        </div>
                        <div class="font-11 font-italic text-muted pt-1">
                            {% for tag in thread.tags.all %}
                                {% if tag.author == current_profile %}
                                    <a class="mr-1" style="color: {{ tag.color }};" href="{% url 'communications:threads' thread_kind tag.title %}">#{{ tag }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="font-11 font-italic text-muted align-top">
                            Ostatnia aktywność: {{ thread.last_activity|date:'d-M-Y' }}
                        </div>
                    </div>
                    <div class="col-auto p-0 ml-auto mt-auto">
                        <div class="mr-2">
                            {% with statements=thread.statements.all|dictsort:"author.id" %}
                                {% regroup statements by author as author_list %}
                                {% for author in author_list %}
                                    <!-- Ensure GM picture is hidden in Debates -->
                                    {% if thread_kind != 'Debate' or author.grouper.status != 'gm' %}
                                        <img class="portait img-xs ml-1 border border-dark
                                            {% if thread_kind == 'Announcement' %}
                                                 rounded
                                            {% elif thread_kind == 'Debate' %}
                                                 rounded-circle
                                            {% endif %}"
                                             src="{{ author.grouper.image.url }}">
                                        <span class="font-13">{{ author.list|length }}</span>
                                    {% endif %}
                                {% endfor %}
                            {% endwith %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
