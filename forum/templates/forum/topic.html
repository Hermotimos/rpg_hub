{% extends 'base.html' %}
{% load custom_filters %}
{% load crispy_forms_tags %}

{% block content %}
     <br>
    {% if request.user.profile not in topic.allowed_profiles.all %}
       <h4>Nie jesteś uczestnikiem tej narady</h4>
    {% else %}
        <h6>Temat: <small>{{ topic.board.title }}</small></h6>
        <h6>Inicjator: <small>{{ topic.starter.profile.character_name }}</small></h6>
        <h6>
            Uczestnicy:
            {% for profile in topic.allowed_profiles.all %}
                {% if profile.character_name != 'MG' %}
                    {% if forloop.counter > 1 %}
                        <small>/ {{ profile }}</small>
                    {% else %}
                        <small>{{ profile }}</small>
                    {% endif %}
                {% endif %}
              {% endfor %}
        </h6>
        <br>
        <div class="mb-4">
            <a href="{% url 'update_topic' topic.board.slug topic.slug %}" class="btn btn-success">Dodaj uczestników narady</a>
        </div>
        <br>

        {% for post in topic.posts.all %}
            {% if post.author.profile.character_name == 'MG' %}
                <table class="posts-and-news">
                <tbody>
                    <div class="border-bottom pt-3">
                        <tr class="posts-and-news-mg">
                            <td>
                                <p>{{ post.text }}</p>
                                {% if post.image %}
                                    <img src="{{ post.image.url }}">
                                {% endif %}
                            </td>
                        </tr>
                    </div>
                </tbody>
                </table>

            {% else %}
                <table class="posts-and-news">
                    <tbody>
                        <div class="border-bottom pt-3">
                        <tr class="posts-and-news">
                            <td>
                                <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}">
                                <small><p>{{ post.author.profile.character_name }}</p></small>
                            </td>
                            <td>
                                <small>{{ post.date_posted|date:'d-M-Y' }}</small>
                                <p>{{ post.text|capfirst }}</p>
                                {% if post.image %}
                                    <img src="{{ post.image.url }}">
                                {% endif %}
                            </td>
                        </tr>
                        </div>
                    </tbody>
                </table>
            {% endif %}
        {% endfor %}
        <br><br>

        <div id="page-bottom">
            <form method="POST" action=".#page-bottom" enctype="multipart/form-data">
                {% csrf_token %}
                {{ post_form|crispy }}
                <br><br>
                <input class="btn btn-success" type="submit" value="Tak rzeknij"}}>
            </form>
        </div>

    {% endif %}
{% endblock content %}